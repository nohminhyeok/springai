<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>내 대화목록</title>
  <style>
    body { font-family: Arial, sans-serif; margin:20px; }
    h1 { margin-bottom:10px; }
    table { width:100%; border-collapse:collapse; margin-top:10px; }
    th, td { border:1px solid #ddd; padding:8px; text-align:left; }
    th { background:#f2f2f2; }
    .btn-back { margin-bottom:10px; padding:6px 12px; background:#0b3d2e; color:#fff; border:none; cursor:pointer; }
  </style>
</head>
<body>
  <button class="btn-back" onclick="location.href='/chat.html'">채팅 화면으로</button>
  <h1>내 대화목록</h1>
  <table>
    <thead>
      <tr><th>시간</th><th>내 메시지</th><th>챗봇 응답</th></tr>
    </thead>
    <tbody id="historyBody">
      <tr><td colspan="3">불러오는 중...</td></tr>
    </tbody>
  </table>

  <script>
    window.addEventListener('DOMContentLoaded', ()=>{
      fetch('/chat/history', { credentials:'include' })
        .then(res=>{
          if(!res.ok){
            alert('로그인이 필요합니다.');
            return location.href='/login.html';
          }
          return res.json();
        })
        .then(list=>{
          const tb = document.getElementById('historyBody');
          tb.innerHTML = '';
          if(!list || !list.length){
            tb.innerHTML = '<tr><td colspan="3">저장된 대화가 없습니다.</td></tr>';
            return;
          }
          list.forEach(item=>{
            const tr = document.createElement('tr');
            const time = new Date(item.createdAt).toLocaleString('ko-KR');
            tr.innerHTML = `
              <td>${time}</td>
              <td>${item.userMsg}</td>
              <td>${item.aiReply}</td>
            `;
            tb.appendChild(tr);
          });
        })
        .catch(e=>{
          console.error(e);
          alert('대화목록 불러오기 중 오류가 발생했습니다.');
        });
    });
  </script>
</body>
</html>
